<link rel="import" href="../polymer/polymer.html">

<!--
custom css:
--bubble-font-size: font size for bubble

ajax:
vignetteImgs (json)
-->

<dom-module id="vignette-box">
    <template>
        <style>
            :host
            {
                width: 1000px;
                max-height: 600px;
                position: relative;
                display: block;   
            }

            #vig
            {
                margin: auto;
                display: block;
                box-shadow: 0 0 40px rgba(0,0,0,.2);
            }

            .bubble
            {
                position: absolute;
                display: table;
                bottom: -10px;
                left: -40px;
                background-image:url("texbubble.png");
                background-size: 100%;
                width: 300px;
                height: 300px;
                box-sizing: border-box;
                padding: 50px;
                font-size: var(--bubble-font-size,40px);
            }
            
            .bubble p
            {
                display: table-cell;
                vertical-align: middle;
                text-align: center;
                color: #581431;
                margin: auto;
                transform: rotate(10deg);
            }

            .texbox
            {
                position: absolute;
            }

            .wide
            {
                width: 100%;
            }

            .tall
            {
                height: 100%;
            }

            .hidden
            {
                opacity: 0;
            }
        </style>

        <img id="vig" class="wide hidden" src="{{vsrc}}">
        <div class="bubble"><p>{{texline}}</p></div>

    </template>

    <script>
        class vignetteBox extends Polymer.Element
        {
            static get is()
            {
                return "vignette-box";
            }

            static get properties()
            {
                return {
                    
                };
            }

            ready()
            {
                super.ready();

                var vget=new XMLHttpRequest;
                vget.open("GET","homepage_resource/vignetteImgs");
                vget.responseType="json";
                vget.onreadystatechange=()=>{
                    if (vget.readyState!=4)
                    {
                        return;
                    }

                    this.vsrc=vget.response.imgs[Math.floor(Math.random()*vget.response.imgs.length)];

                    this.texline=vget.response.text[Math.floor(Math.random()*vget.response.text.length)];

                    var calcTallWide=()=>{
                        if (this.$.vig.height==0 || this.$.vig.width==0)
                        {
                            setTimeout(calcTallWide,100);
                            return;
                        }

                        if (this.$.vig.height>this.$.vig.width)
                        {
                            this.$.vig.classList.add("tall");
                            this.$.vig.classList.remove("wide");
                        }

                        this.$.vig.classList.remove("hidden");
                    };

                    calcTallWide();
                };

                vget.send();

            }

        }

        customElements.define(vignetteBox.is,vignetteBox);
    </script>

</dom-module>